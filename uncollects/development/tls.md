# TLS

TLS加密传输协议位于OSI七层网络模型的表示层，在TCP和HTTP中间。其前身是SSL。

TLS协议大致包括三个阶段：

1. 握手阶段：鉴权和密钥交换
2. 数据交换阶段：保证机密性和完整性
3. 关闭阶段

## 对称密码算法

由于速度优势，一般在数据交换阶段采用的是对称密码算法。所谓对称密码算法，就是加密者和解密者使用同一个密钥。

对称密码算法可以分为流密码算法和分组密码算法。

流密码算法一般是数据流和密钥流进行XOR操作。由于XOR的可逆性，解密时再进行一次XOR就可以。流密码的重点是密钥流的随机性，其不可复用。RC4是经典的流密码算法，但已经是不安全的了，推荐使用ChaCha20。

分组密码算法则一次对一组数据进行加密，现代算法一般是加密128bits，其实现了一个转换函数，将输入变成随机输出。实践中分组密码算法往往是通过分组密码算法模式来实现的。
分组密码算法可以作为hash函数，MAC，伪随机数生成器甚至流密码算法的基础组件。
经典的分组密码算法是AES。

对于分组密码算法而言，最后一个包如果不到组大小，就需要填充，一般填充的最后一个byte指定填充长度，其他空闲byte填充同样的值。

## Hash函数

Hash函数的作用是将任意大小的输入转换为固定大小的输出。在密码学中，Hash函数需要有额外的特性：

1. 不可逆性：无法从hash值还原输入，给定输入也无法找到另一个输入有同样的hash值。
2. 无冲突性：无法找到两个输入有相同的hash值

当前安全的hash函数有SHA2和SHA3，SHA1和MD5被认为是不安全的。

## 消息验证码

虽然Hash函数可以验证数据完整性，但是如果Hash值同时泄露了，攻击者可以修改Hash值来绕过验证。消息验证码MAC解决这个问题的方法是将带密钥的hash值嵌入原始数据中。这样解密者可以根据hash密钥进行校验。
